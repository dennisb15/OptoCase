<!DOCTYPE html>
<html>
<head>
  <title>Professor Dashboard - OptoCase</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0b2e52;
      color: #5aa9e6;
    }

    /* Top Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #08213a;
      padding: 15px 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .navbar img {
      height: 100px; /* big logo */
    }
    .navbar .prof-info {
      color: #5aa9e6;
      font-weight: bold;
      margin-right: auto;
      margin-left: 30px;
      font-size: 20px;
    }
    .navbar button {
      background: linear-gradient(135deg, #2fc4b2, #29a89a);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    .navbar button:hover {
      background: linear-gradient(135deg, #29a89a, #2fc4b2);
    }

    /* Modern Tabs */
    .sidebar {
      display: flex;
      background-color: #093259;
      padding: 15px;
      justify-content: center;
      gap: 30px;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
      padding: 12px 28px;
      border-radius: 30px; /* pill shape */
      background-color: transparent;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    .sidebar a:hover {
      background-color: #2fc4b2;
      color: white;
    }
    .sidebar a.active {
      background-color: #2fc4b2;
      color: white;
      border: 2px solid #29a89a;
    }

    /* Content area */
    .content {
      padding: 40px;
      text-align: center;
    }
    a {
  text-decoration: none;
}

.new-case-btn {
  background-color: #2fc4b2;
  color: white;
  padding: 16px 28px;
  font-size: 20px;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  width: 100%;
  max-width: 300px;
  display: block;
  margin: 40px auto; /* adds nice spacing */
}

.new-case-btn:hover {
  background-color: #29a89a;
  transform: scale(1.05);
}

/* Case Cards - clean box design */
#cases-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-top: 20px;
}

.case-card {
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  text-align: left;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.case-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.case-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid #eee;
}

.case-title {
  margin: 0;
  font-size: 1.2em;
  font-weight: bold;
  color: #0b2e52;
}

.case-status {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: bold;
  text-transform: uppercase;
}

.case-status.finalized {
  background-color: #d4f0d4;
  color: #27632a;
}

.case-status.draft {
  background-color: #fff3cd;
  color: #856404;
}

.case-meta {
  font-size: 0.95em;
  color: #555;
  margin: 10px 0;
}

.case-actions {
  margin-top: 12px;
  display: flex;
  gap: 10px;
}

.edit-btn,
.delete-btn {
  padding: 6px 14px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-size: 0.9em;
  font-weight: bold;
  transition: background 0.2s ease;
}

.edit-btn {
  background: #2fc4b2;
  color: white;
}

.edit-btn:hover {
  background: #29a89a;
}

.delete-btn {
  background: #e63946;
  color: white;
}

.delete-btn:hover {
  background: #c82333;
}
.view-btn {
  background: #0b2e52; /* deep blue to match theme */
  color: white;
  border: none;
  padding: 6px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9em;
  font-weight: bold;
  transition: background 0.2s ease;
}

.view-btn:hover {
  background: #093259;
}

/* Modal Background */
.modal {
  display: none; /* hidden by default */
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.modal-content {
  background: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  width: 80%;
  max-width: 600px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  animation: fadeIn 0.3s ease;
}

/* Close Button */
.close-btn {
  float: right;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  color: #333;
}
.close-btn:hover {
  color: #e63946;
}

@keyframes fadeIn {
  from {opacity: 0; transform: translateY(-20px);}
  to {opacity: 1; transform: translateY(0);}
}

.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-box {
  background: #fff;
  padding: 25px;
  border-radius: 10px;
  width: 350px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.modal-box h3 {
  color: #115680;
  margin-bottom: 15px;
}

.modal-actions {
  margin-top: 20px;
  display: flex;
  justify-content: space-around;
}

.btn-danger {
  background: #c0392b;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
}

.btn-cancel {
  background: #fad739;
  color: #000;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
}


  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <img src="/logo.png" alt="OptoCase Logo">
    <div class="prof-info" id="profName"></div>
    <button onclick="location.href='/'">Logout</button>
  </div>

  <!-- Tabs -->
<div class="sidebar">
  <a href="#" class="active" onclick="showContent('cases', this)">üìÇ View Cases</a>
  <a href="#" onclick="showContent('upload', this)">‚ûï Upload Case</a>
  <a href="#" onclick="showContent('progress', this)">üìä Student Progress</a>
</div>



<!-- Content -->
<div class="content" id="content">
  <h2>Welcome to your dashboard</h2>
  <p>Select an option above to get started.</p>
</div>


  <script>
  function showContent(tab, element) {
    const content = document.getElementById('content');
    const links = document.querySelectorAll('.sidebar a');
    links.forEach(link => link.classList.remove('active'));
    element.classList.add('active');

    if (tab === 'cases') {
  content.innerHTML = `
    <h2>üìÇ View Cases</h2>
    <div id="cases-list" class="cases-container">Loading cases...</div>
  `;

  fetch('/api/cases')
    .then(res => res.json())
    .then(cases => {
      const list = document.getElementById('cases-list');
      if (!cases || cases.length === 0) {
        list.innerHTML = "<p>No cases available yet.</p>";
        return;
      }

      list.innerHTML = cases.map(c => `
        <div class="case-card" data-id="${c.case_id}">
          <div class="case-header">
            <h3 class="case-title">${c.case_name}</h3>
          </div>
          <div class="case-meta">
            <span>üë®‚Äçüè´ <strong>${c.created_by || 'Unknown'}</strong></span>
            <span> | üìÖ ${new Date(c.created_at).toLocaleDateString()}</span>
          </div>
          <div class="case-actions">
            <button class="view-btn" onclick="location.href='/view-cases.html?id=${c.case_id}'">üëÅÔ∏è View</button>
            <button class="edit-btn" onclick="location.href='/wizard/step1?case_id=${c.case_id}'">‚úèÔ∏è Edit</button>
            <button class="delete-btn" onclick="deleteCase(${c.case_id})">üóëÔ∏è Delete</button>
          </div>
        </div>
      `).join('');
    })
    .catch(() => {
      document.getElementById('cases-list').innerHTML = "<p>Error loading cases.</p>";
    });
}





 else if (tab === 'upload') {
      content.innerHTML = `
        <a href="/wizard/step1">
          <button class="new-case-btn">‚ûï Create New Case</button>
        </a>
      `;
      } else if (tab === 'progress') {
      content.innerHTML = `
        <h2>üìä Student Progress</h2>
        <p>Here you will view student progress.</p>
      `;
    }
  }
</script>

<!-- Modal functionality script -->
<script>
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('view-btn')) {
      const card = e.target.closest('.case-card');
      const caseTitle = card.querySelector('.case-title').innerText;
      const caseInstructions = card.getAttribute('data-instructions');

      // Fill modal with case info
      document.getElementById('modal-case-title').innerText = caseTitle;
      document.getElementById('modal-case-status').innerText = "";
      document.getElementById('modal-case-details').innerHTML = `
        <p><strong>Instructions:</strong> ${caseInstructions}</p>
      `;

      // Show modal
      document.getElementById('caseModal').style.display = 'block';
    }

    // Close modal when clicking X or background
    if (e.target.classList.contains('close-btn') || e.target.classList.contains('modal')) {
      document.getElementById('caseModal').style.display = 'none';
    }
  });
</script>

<!-- Fetch username/login script -->
<script>
  fetch('/api/user')
    .then(res => res.json())
    .then(data => {
      if (data.username) {
        document.getElementById('profName').textContent = data.username;
      }
    })
    .catch(() => {
      window.location.href = '/login/professor';
    });
</script>

<!-- Case Modal -->
<div id="caseModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 id="modal-case-title">Case Title</h2>
    <p id="modal-case-status"></p>
    <div id="modal-case-details">
      <!-- dynamic case details will go here -->
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay" style="display: none;">
  <div class="modal-box">
    <h3>‚ö†Ô∏è Confirm Delete</h3>
    <p>Are you sure you want to delete this case?</p>
    <div class="modal-actions">
      <button id="confirmDelete" class="btn-danger">Yes, Delete</button>
      <button id="cancelDelete" class="btn-cancel">Cancel</button>
    </div>
  </div>
</div>

<script>
  let caseToDelete = null;

  function deleteCase(caseId) {
    caseToDelete = caseId;
    document.getElementById("deleteModal").style.display = "flex"; // show modal
  }

  // Cancel button
  document.getElementById("cancelDelete").addEventListener("click", () => {
    document.getElementById("deleteModal").style.display = "none";
    caseToDelete = null;
  });

  // Confirm button
  document.getElementById("confirmDelete").addEventListener("click", () => {
    if (!caseToDelete) return;

    fetch(`/api/cases/${caseToDelete}`, { method: "DELETE" })
      .then(res => res.json())
      .then(result => {
        document.getElementById("deleteModal").style.display = "none";
        if (result.success) {
          showContent("cases", document.querySelector(".sidebar a.active")); // reload cases
        } else {
          alert("‚ùå Failed to delete case.");
        }
      })
      .catch(() => {
        document.getElementById("deleteModal").style.display = "none";
        alert("‚ùå Error deleting case.");
      });
  });
</script>
</body>
</html>




